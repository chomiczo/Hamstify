<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#111827">
    <title>Hamstify PRO</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="/static/js/app.js" defer></script>

    <link rel="manifest" href="/static/manifest.json">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Hamstify">
    <link rel="apple-touch-icon" href="/static/icon.png">
</head>
<body class="bg-gray-900 text-white flex flex-col h-screen overflow-hidden font-sans select-none">

    <div id="authScreen" class="fixed inset-0 z-50 bg-gray-900 flex flex-col justify-center items-center p-6">
        <h1 class="text-4xl font-black italic text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-500 mb-8">HAMSTIFY</h1>
        <div class="w-full max-w-sm bg-gray-800 p-6 rounded-2xl shadow-2xl border border-gray-700">
            <div class="flex mb-6 bg-gray-900 p-1 rounded-xl">
                <button id="tabLogin" onclick="toggleAuthMode('login')" class="flex-1 py-2 text-sm rounded-lg bg-indigo-600 text-white font-bold transition-all">Logowanie</button>
                <button id="tabRegister" onclick="toggleAuthMode('register')" class="flex-1 py-2 text-sm rounded-lg text-gray-400 hover:text-white transition-all">Rejestracja</button>
            </div>
            <div class="space-y-4">
                <input id="loginUser" type="text" placeholder="Nazwa użytkownika" class="w-full p-4 rounded-xl bg-gray-900 border border-gray-700 outline-none focus:border-indigo-500 text-white placeholder-gray-500">
                <input id="loginEmail" type="email" placeholder="Adres Email" class="hidden w-full p-4 rounded-xl bg-gray-900 border border-gray-700 outline-none focus:border-indigo-500 text-white placeholder-gray-500">
                <input id="loginPass" type="password" placeholder="Hasło" class="w-full p-4 rounded-xl bg-gray-900 border border-gray-700 outline-none focus:border-indigo-500 text-white placeholder-gray-500">
                <button id="authBtn" onclick="handleAuthAction()" class="w-full p-4 rounded-xl bg-indigo-600 font-bold text-white shadow-lg hover:bg-indigo-500 active:scale-95 transition-transform">ZALOGUJ SIĘ</button>
                <p id="authMsg" class="text-center text-red-400 text-sm min-h-[20px] mt-2"></p>
            </div>
        </div>
    </div>

    <div id="appContainer" class="hidden flex flex-col h-full">
        <div class="p-4 bg-gradient-to-b from-gray-900 to-transparent z-10 w-full mx-auto max-w-md flex justify-between items-center">
            <h1 class="text-xl font-black italic text-indigo-500">HAMSTIFY</h1>
            <div class="text-xs text-gray-400">Witaj, <span id="displayUsername" class="text-white font-bold"></span></div>
        </div>

        <main class="flex-1 overflow-y-auto w-full max-w-md mx-auto pb-48 px-4 scroll-smooth" id="mainContainer">
            
            <div id="view-home" class="space-y-6 pt-2 relative">
                 <div class="relative group z-20">
                    <form onsubmit="handleSearch(event)">
                        <input id="searchInp" type="search" placeholder="Szukaj utworów..." autocomplete="off"
                               oninput="handleInput(this.value)"
                               class="w-full py-3 px-5 pr-12 rounded-2xl bg-gray-800 border border-gray-700 text-white focus:border-indigo-500 transition-all shadow-lg outline-none">
                        <button type="submit" class="absolute right-3 top-1/2 -translate-y-1/2 p-2 text-gray-400 hover:text-indigo-400">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                    </form>
                    <div id="suggestionsBox" class="hidden absolute top-full left-0 right-0 mt-2 bg-gray-800 border border-gray-700 rounded-xl shadow-2xl overflow-hidden z-30"></div>
                </div>

                <div>
                    <h2 id="recTitle" class="text-lg font-bold mb-3 text-gray-100 mt-4">Ładowanie...</h2>
                    <div id="recContainer" class="grid grid-cols-2 gap-3 pb-10"></div>
                </div>
            </div>

            <div id="view-search" class="hidden pt-2">
                <button onclick="switchTab('home')" class="mb-4 text-sm text-gray-400 flex items-center gap-2 hover:text-white"><i class="fa-solid fa-arrow-left"></i> Wróć</button>
                <h2 class="text-lg font-bold mb-3">Wyniki wyszukiwania</h2>
                <div id="results" class="space-y-3 pb-10"></div>
            </div>

            <div id="view-library" class="hidden pt-2 space-y-4">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold">Biblioteka</h2>
                    <button onclick="createNewPlaylist()" class="bg-gray-800 p-2 rounded-lg text-sm hover:bg-gray-700"><i class="fa-solid fa-plus mr-1"></i> Nowa playlista</button>
                </div>
                <div id="playlistsContainer" class="space-y-3 pb-10"></div>
                <button onclick="logout()" class="w-full mt-10 py-2 border border-red-900 text-red-500 rounded-lg text-xs">Wyloguj się</button>
            </div>

        </main>
    </div>

    <div id="playlistModal" class="hidden fixed inset-0 z-[60] bg-black/80 flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-2xl p-5 w-full max-w-sm border border-gray-700">
            <h3 class="font-bold text-lg mb-4 text-white">Dodaj do playlisty</h3>
            <div id="modalPlaylists" class="space-y-2 max-h-60 overflow-y-auto mb-4 custom-scroll"></div>
            <button onclick="closeModal()" class="w-full py-3 rounded-xl bg-gray-700 text-gray-300 hover:bg-gray-600">Anuluj</button>
        </div>
    </div>

    <div id="player" class="fixed bottom-[65px] left-2 right-2 bg-gray-800/95 backdrop-blur border border-gray-700/50 p-4 hidden max-w-md mx-auto rounded-2xl shadow-2xl z-40 transition-transform">
        <div class="flex items-center gap-3 mb-3">
            <img id="playerThumb" src="" class="w-12 h-12 rounded-lg bg-gray-700 object-cover shadow-md rotate-anim">
            <div class="flex-1 min-w-0">
                <p id="nowPlayingTitle" class="text-sm font-bold truncate text-white">Tytuł</p>
                <p id="nowPlayingArtist" class="text-xs text-gray-400 truncate">Artysta</p>
            </div>
            <button onclick="downloadCurrentTrack()" class="p-2 text-gray-400 hover:text-indigo-400">
                <i class="fa-solid fa-download"></i>
            </button>
        </div>

        <div class="flex flex-col gap-3">
            <div class="flex items-center gap-2 text-[10px] text-gray-400 font-mono">
                <span id="currTime">0:00</span>
                <input id="progressBar" type="range" min="0" value="0" step="1" 
                       class="w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-indigo-500">
                <span id="durTime">0:00</span>
            </div>

            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 w-1/4">
                    <i class="fa-solid fa-volume-low text-xs text-gray-500"></i>
                    <input id="volBar" type="range" min="0" max="1" step="0.1" value="1" 
                           class="w-full h-1 bg-gray-600 rounded-lg cursor-pointer accent-white">
                </div>

                <div class="flex items-center gap-4">
                    <button onclick="playPrev()" class="text-gray-300 hover:text-white text-xl"><i class="fa-solid fa-backward-step"></i></button>
                    <button id="playPauseBtn" onclick="togglePlay()" class="w-10 h-10 flex items-center justify-center bg-indigo-500 rounded-full shadow-lg text-white hover:scale-105 transition">
                        <i class="fa-solid fa-pause"></i>
                    </button>
                    <button onclick="playNext()" class="text-gray-300 hover:text-white text-xl"><i class="fa-solid fa-forward-step"></i></button>
                </div>
                
                <div class="w-1/4"></div>
            </div>
        </div>

        <audio id="audioElement" onended="playNext()" ontimeupdate="updateProgress()" onloadedmetadata="setDuration()"></audio>
    </div>

    <nav id="navbar" class="hidden fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-800 flex justify-around items-center h-[60px] z-50 max-w-md mx-auto">
        <button onclick="switchTab('home')" class="nav-btn active flex flex-col items-center justify-center w-full h-full text-gray-500 hover:text-indigo-400" id="btn-home">
            <i class="fa-solid fa-house text-xl mb-1"></i><span class="text-[10px]">Start</span>
        </button>
        <button onclick="switchTab('search')" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-500 hover:text-indigo-400" id="btn-search">
            <i class="fa-solid fa-magnifying-glass text-xl mb-1"></i><span class="text-[10px]">Szukaj</span>
        </button>
        <button onclick="switchTab('library')" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-500 hover:text-indigo-400" id="btn-library">
            <i class="fa-solid fa-layer-group text-xl mb-1"></i><span class="text-[10px]">Biblioteka</span>
        </button>
    </nav>
    
    <style>
        .nav-btn.active { color: #818cf8; }
        .rotate-anim { animation: spin 10s linear infinite; animation-play-state: paused; }
        .playing .rotate-anim { animation-play-state: running; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        /* Custom Range Slider */
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 12px; width: 12px; border-radius: 50%; background: #6366f1; margin-top: -4px; box-shadow: 0 0 5px rgba(99, 102, 241, 0.5); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #374151; border-radius: 2px; }
        
        /* Volume Slider Specifics */
        #volBar::-webkit-slider-thumb { background: #fff; height: 10px; width: 10px; margin-top: -3px; box-shadow: none; }
    </style>
</body>
</html>